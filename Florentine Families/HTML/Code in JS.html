<div style="overflow:auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family:monospace;"><span style="color: #666666; font-style: italic;"># Set up the libraries and all that jazz</span>
&nbsp;
<a href="http://inside-r.org/r-doc/base/rm"><span style="color: #003399; font-weight: bold;">rm</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a> = <a href="http://inside-r.org/r-doc/base/ls"><span style="color: #003399; font-weight: bold;">ls</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">if</span><span style="color: #009900;">&#40;</span><span style="">!</span><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">&#40;</span>networkD3<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <a href="http://inside-r.org/r-doc/utils/install.packages"><span style="color: #003399; font-weight: bold;">install.packages</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;networkD3&quot;</span><span style="color: #339933;">,</span> repos = <span style="color: #0000ff;">&quot;http://cran.ma.imperial.ac.uk/&quot;</span> <span style="color: #009900;">&#41;</span>
  <a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span>networkD3<span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
  <a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">&#40;</span>networkD3<span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># Load up `Node List` and `Edge List` for the network</span>
&nbsp;
nodeList <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/file"><span style="color: #003399; font-weight: bold;">file</span></a> = <span style="color: #0000ff;">&quot;http://owensims.co.uk/projects/FlorentineFamilies/FlorentineFamilies.csv&quot;</span><span style="color: #339933;">,</span> header = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #339933;">,</span> sep = <span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #009900;">&#41;</span>
edgeList <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/file"><span style="color: #003399; font-weight: bold;">file</span></a> = <span style="color: #0000ff;">&quot;http://owensims.co.uk/projects/FlorentineFamilies/MarriageLinks.csv&quot;</span><span style="color: #339933;">,</span> header = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #339933;">,</span> sep = <span style="color: #0000ff;">&quot;,&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># Clean up the `Node List` and `Edge List` for networkD3</span>
&nbsp;
nodeList<span style="">$</span>Lat <span style="">&lt;-</span> nodeList<span style="">$</span>lat10 <span style="">&lt;-</span> nodeList<span style="">$</span>Long <span style="">&lt;-</span> nodeList<span style="">$</span>long10 <span style="">&lt;-</span> <span style="color: #000000; font-weight: bold;">NULL</span>
nodeList<span style="">$</span>Gross.Wealth <span style="">&lt;-</span> nodeList<span style="">$</span>Gross.Wealth<span style="">/</span><span style="color: #cc66cc;">10000</span>
<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">&#40;</span>nodeList<span style="color: #009900;">&#41;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;name&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;faction&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;wealth&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;brokerage&quot;</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">&#40;</span>edgeList<span style="color: #009900;">&#41;</span> <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;source&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;target&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;weight&quot;</span><span style="color: #009900;">&#41;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># Rebase node IDs for analysis</span>
&nbsp;
nodeList<span style="">$</span>newID <span style="">&lt;-</span> <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">&#40;</span><a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="">:</span><a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">&#40;</span>nodeList<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="">-</span> <span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
<a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">&#40;</span>nodeList<span style="color: #009900;">&#91;</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399; font-weight: bold;">ncol</span></a><span style="color: #009900;">&#40;</span>nodeList<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="">&lt;-</span> <span style="color: #0000ff;">&quot;newID&quot;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span><a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">&#40;</span>nodeList<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #000000; font-weight: bold;">for</span> <span style="color: #009900;">&#40;</span>j <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span><span style="">:</span><a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">&#40;</span>edgeList<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeList<span style="">$</span>id<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">==</span> edgeList<span style="">$</span>source<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      edgeList<span style="">$</span>source<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> nodeList<span style="">$</span>newID<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>
    <span style="color: #009900;">&#125;</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>nodeList<span style="">$</span>id<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="">==</span> edgeList<span style="">$</span>target<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      edgeList<span style="">$</span>target<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="">&lt;-</span> nodeList<span style="">$</span>newID<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #666666; font-style: italic;"># Generate the Florentine marriage network</span>
&nbsp;
forceNetwork<span style="color: #009900;">&#40;</span>Links = edgeList<span style="color: #339933;">,</span> Nodes = nodeList<span style="color: #339933;">,</span> Source = <span style="color: #0000ff;">&quot;source&quot;</span><span style="color: #339933;">,</span>
             Target = <span style="color: #0000ff;">&quot;target&quot;</span><span style="color: #339933;">,</span> Value = <span style="color: #0000ff;">&quot;weight&quot;</span><span style="color: #339933;">,</span> NodeID = <span style="color: #0000ff;">&quot;name&quot;</span><span style="color: #339933;">,</span>
             Group = <span style="color: #0000ff;">&quot;faction&quot;</span><span style="color: #339933;">,</span> colourScale = JS<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;d3.scale.category10()&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span>
             fontSize = <span style="color: #cc66cc;">14</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/legend"><span style="color: #003399; font-weight: bold;">legend</span></a> = <span style="color: #000000; font-weight: bold;">FALSE</span><span style="color: #339933;">,</span> fontFamily = <span style="color: #0000ff;">&quot;Helvetica&quot;</span><span style="color: #339933;">,</span> opacityNoHover = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #339933;">,</span> height = <span style="color: #cc66cc;">600</span><span style="color: #339933;">,</span>
             width = <span style="color: #cc66cc;">600</span><span style="color: #339933;">,</span> linkColour = <span style="color: #0000ff;">&quot;#888&quot;</span><span style="color: #339933;">,</span> linkDistance = <span style="color: #cc66cc;">250</span><span style="color: #339933;">,</span> Nodesize = <span style="color: #0000ff;">&quot;wealth&quot;</span><span style="color: #339933;">,</span> opacity = <span style="color: #cc66cc;">0.9</span><span style="color: #339933;">,</span> zoom = <span style="color: #000000; font-weight: bold;">TRUE</span><span style="color: #009900;">&#41;</span></pre></div></div>